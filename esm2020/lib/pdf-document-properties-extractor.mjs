export class PdfDocumentPropertiesExtractor {
    constructor() {
        this.pdfDateStringRegex = new RegExp('^D:' + // Prefix (required)
            '(\\d{4})' + // Year (required)
            '(\\d{2})?' + // Month (optional)
            '(\\d{2})?' + // Day (optional)
            '(\\d{2})?' + // Hour (optional)
            '(\\d{2})?' + // Minute (optional)
            '(\\d{2})?' + // Second (optional)
            '([Z|+|-])?' + // Universal time relation (optional)
            '(\\d{2})?' + // Offset hour (optional)
            // tslint:disable-next-line: quotemark
            "'?" + // Splitting apostrophe (optional)
            '(\\d{2})?' + // Offset minute (optional)
            // tslint:disable-next-line: quotemark
            "'?" // Trailing apostrophe (optional)
        );
    }
    async getDocumentProperties() {
        const PDFViewerApplication = window.PDFViewerApplication;
        const pdfDocument = PDFViewerApplication.pdfDocument;
        const result = {};
        return pdfDocument
            .getMetadata()
            .then(({ info, _metadata, contentDispositionFilename }) => {
            result.author = info.Author;
            result.creationDate = this.toDateObject(info.CreationDate);
            result.creator = info.Creator;
            result.keywords = info.Keywords;
            result.linearized = info.IsLinearized;
            result.modificationDate = this.toDateObject(info.ModDate);
            result.pdfFormatVersion = info.PDFFormatVersion;
            result.producer = info.Producer;
            result.subject = info.Subject;
            result.title = info.Title;
            if (contentDispositionFilename) {
                result.fileName = contentDispositionFilename;
            }
            return pdfDocument.getDownloadInfo();
        })
            .then(({ length }) => {
            result.maybeFileSize = length;
            return result;
        });
    }
    /** shamelessly copied from pdf.js */
    toDateObject(input) {
        // Optional fields that don't satisfy the requirements from the regular
        // expression (such as incorrect digit counts or numbers that are out of
        // range) will fall back the defaults from the specification.
        const matches = this.pdfDateStringRegex.exec(input);
        if (!matches) {
            return null;
        }
        // JavaScript's `Date` object expects the month to be between 0 and 11
        // instead of 1 and 12, so we have to correct for that.
        const year = parseInt(matches[1], 10);
        let month = parseInt(matches[2], 10);
        month = month >= 1 && month <= 12 ? month - 1 : 0;
        let day = parseInt(matches[3], 10);
        day = day >= 1 && day <= 31 ? day : 1;
        let hour = parseInt(matches[4], 10);
        hour = hour >= 0 && hour <= 23 ? hour : 0;
        let minute = parseInt(matches[5], 10);
        minute = minute >= 0 && minute <= 59 ? minute : 0;
        let second = parseInt(matches[6], 10);
        second = second >= 0 && second <= 59 ? second : 0;
        const universalTimeRelation = matches[7] || 'Z';
        let offsetHour = parseInt(matches[8], 10);
        offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;
        let offsetMinute = parseInt(matches[9], 10) || 0;
        offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;
        // Universal time relation 'Z' means that the local time is equal to the
        // universal time, whereas the relations '+'/'-' indicate that the local
        // time is later respectively earlier than the universal time. Every date
        // is normalized to universal time.
        if (universalTimeRelation === '-') {
            hour += offsetHour;
            minute += offsetMinute;
        }
        else if (universalTimeRelation === '+') {
            hour -= offsetHour;
            minute -= offsetMinute;
        }
        return new Date(Date.UTC(year, month, day, hour, minute, second));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGRmLWRvY3VtZW50LXByb3BlcnRpZXMtZXh0cmFjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWV4dGVuZGVkLXBkZi12aWV3ZXIvc3JjL2xpYi9wZGYtZG9jdW1lbnQtcHJvcGVydGllcy1leHRyYWN0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUJBLE1BQU0sT0FBTyw4QkFBOEI7SUFBM0M7UUFDVSx1QkFBa0IsR0FBRyxJQUFJLE1BQU0sQ0FDckMsS0FBSyxHQUFHLG9CQUFvQjtZQUMxQixVQUFVLEdBQUcsa0JBQWtCO1lBQy9CLFdBQVcsR0FBRyxtQkFBbUI7WUFDakMsV0FBVyxHQUFHLGlCQUFpQjtZQUMvQixXQUFXLEdBQUcsa0JBQWtCO1lBQ2hDLFdBQVcsR0FBRyxvQkFBb0I7WUFDbEMsV0FBVyxHQUFHLG9CQUFvQjtZQUNsQyxZQUFZLEdBQUcscUNBQXFDO1lBQ3BELFdBQVcsR0FBRyx5QkFBeUI7WUFDdkMsc0NBQXNDO1lBQ3RDLElBQUksR0FBRyxrQ0FBa0M7WUFDekMsV0FBVyxHQUFHLDJCQUEyQjtZQUN6QyxzQ0FBc0M7WUFDdEMsSUFBSSxDQUFDLGlDQUFpQztTQUN6QyxDQUFDO0lBMEVKLENBQUM7SUF4RVEsS0FBSyxDQUFDLHFCQUFxQjtRQUNoQyxNQUFNLG9CQUFvQixHQUEyQixNQUFjLENBQUMsb0JBQW9CLENBQUM7UUFDekYsTUFBTSxXQUFXLEdBQUcsb0JBQW9CLENBQUMsV0FBVyxDQUFDO1FBRXJELE1BQU0sTUFBTSxHQUFRLEVBQUUsQ0FBQztRQUN2QixPQUFPLFdBQVc7YUFDZixXQUFXLEVBQUU7YUFDYixJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsMEJBQTBCLEVBQUUsRUFBRSxFQUFFO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUM1QixNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUM5QixNQUFNLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDaEMsTUFBTSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMxRCxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDO1lBQ2hELE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNoQyxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDOUIsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzFCLElBQUksMEJBQTBCLEVBQUU7Z0JBQzlCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsMEJBQTBCLENBQUM7YUFDOUM7WUFDRCxPQUFPLFdBQVcsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN2QyxDQUFDLENBQUM7YUFDRCxJQUFJLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUU7WUFDbkIsTUFBTSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7WUFDOUIsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQscUNBQXFDO0lBQzdCLFlBQVksQ0FBQyxLQUFtQjtRQUN0Qyx1RUFBdUU7UUFDdkUsd0VBQXdFO1FBQ3hFLDZEQUE2RDtRQUM3RCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsc0VBQXNFO1FBQ3RFLHVEQUF1RDtRQUN2RCxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckMsS0FBSyxHQUFHLEtBQUssSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xELElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDbkMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEMsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNwQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQyxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xELElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDdEMsTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLElBQUksTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxxQkFBcUIsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDO1FBQ2hELElBQUksVUFBVSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDMUMsVUFBVSxHQUFHLFVBQVUsSUFBSSxDQUFDLElBQUksVUFBVSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEUsSUFBSSxZQUFZLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsWUFBWSxHQUFHLFlBQVksSUFBSSxDQUFDLElBQUksWUFBWSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUUsd0VBQXdFO1FBQ3hFLHdFQUF3RTtRQUN4RSx5RUFBeUU7UUFDekUsbUNBQW1DO1FBQ25DLElBQUkscUJBQXFCLEtBQUssR0FBRyxFQUFFO1lBQ2pDLElBQUksSUFBSSxVQUFVLENBQUM7WUFDbkIsTUFBTSxJQUFJLFlBQVksQ0FBQztTQUN4QjthQUFNLElBQUkscUJBQXFCLEtBQUssR0FBRyxFQUFFO1lBQ3hDLElBQUksSUFBSSxVQUFVLENBQUM7WUFDbkIsTUFBTSxJQUFJLFlBQVksQ0FBQztTQUN4QjtRQUVELE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDcEUsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVBERlZpZXdlckFwcGxpY2F0aW9uIH0gZnJvbSAnLi9vcHRpb25zL3BkZi12aWV3ZXItYXBwbGljYXRpb24nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQZGZEb2N1bWVudEluZm8ge1xyXG4gIGF1dGhvcj86IHN0cmluZztcclxuICBjcmVhdGlvbkRhdGU/OiBEYXRlO1xyXG4gIGNyZWF0b3I/OiBzdHJpbmc7XHJcblxyXG4gIGtleXdvcmRzPzogc3RyaW5nO1xyXG4gIGxpbmVhcml6ZWQ/OiBib29sZWFuO1xyXG4gIG1heWJlRmlsZVNpemU/OiBzdHJpbmc7XHJcbiAgbW9kaWZpY2F0aW9uRGF0ZT86IERhdGU7XHJcbiAgcGRmRm9ybWF0VmVyc2lvbj86IHN0cmluZztcclxuICBwcm9kdWNlcj86IHN0cmluZztcclxuICBzdWJqZWN0Pzogc3RyaW5nO1xyXG4gIHRpdGxlPzogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUGRmRG9jdW1lbnRQcm9wZXJ0aWVzRXh0cmFjdG9yIHtcclxuICBwcml2YXRlIHBkZkRhdGVTdHJpbmdSZWdleCA9IG5ldyBSZWdFeHAoXHJcbiAgICAnXkQ6JyArIC8vIFByZWZpeCAocmVxdWlyZWQpXHJcbiAgICAgICcoXFxcXGR7NH0pJyArIC8vIFllYXIgKHJlcXVpcmVkKVxyXG4gICAgICAnKFxcXFxkezJ9KT8nICsgLy8gTW9udGggKG9wdGlvbmFsKVxyXG4gICAgICAnKFxcXFxkezJ9KT8nICsgLy8gRGF5IChvcHRpb25hbClcclxuICAgICAgJyhcXFxcZHsyfSk/JyArIC8vIEhvdXIgKG9wdGlvbmFsKVxyXG4gICAgICAnKFxcXFxkezJ9KT8nICsgLy8gTWludXRlIChvcHRpb25hbClcclxuICAgICAgJyhcXFxcZHsyfSk/JyArIC8vIFNlY29uZCAob3B0aW9uYWwpXHJcbiAgICAgICcoW1p8K3wtXSk/JyArIC8vIFVuaXZlcnNhbCB0aW1lIHJlbGF0aW9uIChvcHRpb25hbClcclxuICAgICAgJyhcXFxcZHsyfSk/JyArIC8vIE9mZnNldCBob3VyIChvcHRpb25hbClcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBxdW90ZW1hcmtcclxuICAgICAgXCInP1wiICsgLy8gU3BsaXR0aW5nIGFwb3N0cm9waGUgKG9wdGlvbmFsKVxyXG4gICAgICAnKFxcXFxkezJ9KT8nICsgLy8gT2Zmc2V0IG1pbnV0ZSAob3B0aW9uYWwpXHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogcXVvdGVtYXJrXHJcbiAgICAgIFwiJz9cIiAvLyBUcmFpbGluZyBhcG9zdHJvcGhlIChvcHRpb25hbClcclxuICApO1xyXG5cclxuICBwdWJsaWMgYXN5bmMgZ2V0RG9jdW1lbnRQcm9wZXJ0aWVzKCk6IFByb21pc2U8YW55PiB7XHJcbiAgICBjb25zdCBQREZWaWV3ZXJBcHBsaWNhdGlvbjogSVBERlZpZXdlckFwcGxpY2F0aW9uID0gKHdpbmRvdyBhcyBhbnkpLlBERlZpZXdlckFwcGxpY2F0aW9uO1xyXG4gICAgY29uc3QgcGRmRG9jdW1lbnQgPSBQREZWaWV3ZXJBcHBsaWNhdGlvbi5wZGZEb2N1bWVudDtcclxuXHJcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHt9O1xyXG4gICAgcmV0dXJuIHBkZkRvY3VtZW50XHJcbiAgICAgIC5nZXRNZXRhZGF0YSgpXHJcbiAgICAgIC50aGVuKCh7IGluZm8sIF9tZXRhZGF0YSwgY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWUgfSkgPT4ge1xyXG4gICAgICAgIHJlc3VsdC5hdXRob3IgPSBpbmZvLkF1dGhvcjtcclxuICAgICAgICByZXN1bHQuY3JlYXRpb25EYXRlID0gdGhpcy50b0RhdGVPYmplY3QoaW5mby5DcmVhdGlvbkRhdGUpO1xyXG4gICAgICAgIHJlc3VsdC5jcmVhdG9yID0gaW5mby5DcmVhdG9yO1xyXG4gICAgICAgIHJlc3VsdC5rZXl3b3JkcyA9IGluZm8uS2V5d29yZHM7XHJcbiAgICAgICAgcmVzdWx0LmxpbmVhcml6ZWQgPSBpbmZvLklzTGluZWFyaXplZDtcclxuICAgICAgICByZXN1bHQubW9kaWZpY2F0aW9uRGF0ZSA9IHRoaXMudG9EYXRlT2JqZWN0KGluZm8uTW9kRGF0ZSk7XHJcbiAgICAgICAgcmVzdWx0LnBkZkZvcm1hdFZlcnNpb24gPSBpbmZvLlBERkZvcm1hdFZlcnNpb247XHJcbiAgICAgICAgcmVzdWx0LnByb2R1Y2VyID0gaW5mby5Qcm9kdWNlcjtcclxuICAgICAgICByZXN1bHQuc3ViamVjdCA9IGluZm8uU3ViamVjdDtcclxuICAgICAgICByZXN1bHQudGl0bGUgPSBpbmZvLlRpdGxlO1xyXG4gICAgICAgIGlmIChjb250ZW50RGlzcG9zaXRpb25GaWxlbmFtZSkge1xyXG4gICAgICAgICAgcmVzdWx0LmZpbGVOYW1lID0gY29udGVudERpc3Bvc2l0aW9uRmlsZW5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwZGZEb2N1bWVudC5nZXREb3dubG9hZEluZm8oKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHsgbGVuZ3RoIH0pID0+IHtcclxuICAgICAgICByZXN1bHQubWF5YmVGaWxlU2l6ZSA9IGxlbmd0aDtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBzaGFtZWxlc3NseSBjb3BpZWQgZnJvbSBwZGYuanMgKi9cclxuICBwcml2YXRlIHRvRGF0ZU9iamVjdChpbnB1dDogc3RyaW5nIHwgYW55KTogRGF0ZSB8IG51bGwge1xyXG4gICAgLy8gT3B0aW9uYWwgZmllbGRzIHRoYXQgZG9uJ3Qgc2F0aXNmeSB0aGUgcmVxdWlyZW1lbnRzIGZyb20gdGhlIHJlZ3VsYXJcclxuICAgIC8vIGV4cHJlc3Npb24gKHN1Y2ggYXMgaW5jb3JyZWN0IGRpZ2l0IGNvdW50cyBvciBudW1iZXJzIHRoYXQgYXJlIG91dCBvZlxyXG4gICAgLy8gcmFuZ2UpIHdpbGwgZmFsbCBiYWNrIHRoZSBkZWZhdWx0cyBmcm9tIHRoZSBzcGVjaWZpY2F0aW9uLlxyXG4gICAgY29uc3QgbWF0Y2hlcyA9IHRoaXMucGRmRGF0ZVN0cmluZ1JlZ2V4LmV4ZWMoaW5wdXQpO1xyXG4gICAgaWYgKCFtYXRjaGVzKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEphdmFTY3JpcHQncyBgRGF0ZWAgb2JqZWN0IGV4cGVjdHMgdGhlIG1vbnRoIHRvIGJlIGJldHdlZW4gMCBhbmQgMTFcclxuICAgIC8vIGluc3RlYWQgb2YgMSBhbmQgMTIsIHNvIHdlIGhhdmUgdG8gY29ycmVjdCBmb3IgdGhhdC5cclxuICAgIGNvbnN0IHllYXIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxMCk7XHJcbiAgICBsZXQgbW9udGggPSBwYXJzZUludChtYXRjaGVzWzJdLCAxMCk7XHJcbiAgICBtb250aCA9IG1vbnRoID49IDEgJiYgbW9udGggPD0gMTIgPyBtb250aCAtIDEgOiAwO1xyXG4gICAgbGV0IGRheSA9IHBhcnNlSW50KG1hdGNoZXNbM10sIDEwKTtcclxuICAgIGRheSA9IGRheSA+PSAxICYmIGRheSA8PSAzMSA/IGRheSA6IDE7XHJcbiAgICBsZXQgaG91ciA9IHBhcnNlSW50KG1hdGNoZXNbNF0sIDEwKTtcclxuICAgIGhvdXIgPSBob3VyID49IDAgJiYgaG91ciA8PSAyMyA/IGhvdXIgOiAwO1xyXG4gICAgbGV0IG1pbnV0ZSA9IHBhcnNlSW50KG1hdGNoZXNbNV0sIDEwKTtcclxuICAgIG1pbnV0ZSA9IG1pbnV0ZSA+PSAwICYmIG1pbnV0ZSA8PSA1OSA/IG1pbnV0ZSA6IDA7XHJcbiAgICBsZXQgc2Vjb25kID0gcGFyc2VJbnQobWF0Y2hlc1s2XSwgMTApO1xyXG4gICAgc2Vjb25kID0gc2Vjb25kID49IDAgJiYgc2Vjb25kIDw9IDU5ID8gc2Vjb25kIDogMDtcclxuICAgIGNvbnN0IHVuaXZlcnNhbFRpbWVSZWxhdGlvbiA9IG1hdGNoZXNbN10gfHwgJ1onO1xyXG4gICAgbGV0IG9mZnNldEhvdXIgPSBwYXJzZUludChtYXRjaGVzWzhdLCAxMCk7XHJcbiAgICBvZmZzZXRIb3VyID0gb2Zmc2V0SG91ciA+PSAwICYmIG9mZnNldEhvdXIgPD0gMjMgPyBvZmZzZXRIb3VyIDogMDtcclxuICAgIGxldCBvZmZzZXRNaW51dGUgPSBwYXJzZUludChtYXRjaGVzWzldLCAxMCkgfHwgMDtcclxuICAgIG9mZnNldE1pbnV0ZSA9IG9mZnNldE1pbnV0ZSA+PSAwICYmIG9mZnNldE1pbnV0ZSA8PSA1OSA/IG9mZnNldE1pbnV0ZSA6IDA7XHJcblxyXG4gICAgLy8gVW5pdmVyc2FsIHRpbWUgcmVsYXRpb24gJ1onIG1lYW5zIHRoYXQgdGhlIGxvY2FsIHRpbWUgaXMgZXF1YWwgdG8gdGhlXHJcbiAgICAvLyB1bml2ZXJzYWwgdGltZSwgd2hlcmVhcyB0aGUgcmVsYXRpb25zICcrJy8nLScgaW5kaWNhdGUgdGhhdCB0aGUgbG9jYWxcclxuICAgIC8vIHRpbWUgaXMgbGF0ZXIgcmVzcGVjdGl2ZWx5IGVhcmxpZXIgdGhhbiB0aGUgdW5pdmVyc2FsIHRpbWUuIEV2ZXJ5IGRhdGVcclxuICAgIC8vIGlzIG5vcm1hbGl6ZWQgdG8gdW5pdmVyc2FsIHRpbWUuXHJcbiAgICBpZiAodW5pdmVyc2FsVGltZVJlbGF0aW9uID09PSAnLScpIHtcclxuICAgICAgaG91ciArPSBvZmZzZXRIb3VyO1xyXG4gICAgICBtaW51dGUgKz0gb2Zmc2V0TWludXRlO1xyXG4gICAgfSBlbHNlIGlmICh1bml2ZXJzYWxUaW1lUmVsYXRpb24gPT09ICcrJykge1xyXG4gICAgICBob3VyIC09IG9mZnNldEhvdXI7XHJcbiAgICAgIG1pbnV0ZSAtPSBvZmZzZXRNaW51dGU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoLCBkYXksIGhvdXIsIG1pbnV0ZSwgc2Vjb25kKSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==